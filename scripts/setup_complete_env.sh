#!/bin/bash

# Script de instalaciรณn completa del entorno de desarrollo
# Instala SDKMAN!, Java, Maven, NVM, Node.js, Angular CLI y verifica Docker

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ     ๐ INSTALACIรN COMPLETA DEL ENTORNO DE DESARROLLO    โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "Este script instalarรก:"
echo "  โ SDKMAN! (gestor de SDKs)"
echo "  โ Java 21 LTS"
echo "  โ Maven"
echo "  โ NVM (Node Version Manager)"
echo "  โ Node.js LTS"
echo "  โ Angular CLI"
echo "  โ Verificaciรณn de Docker"
echo ""
read -p "ยฟDeseas continuar? (y/n): " -n 1 -r
echo ""
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "Instalaciรณn cancelada."
    exit 1
fi

# Colores
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 1. INSTALAR SDKMAN!
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "1๏ธโฃ  INSTALANDO SDKMAN!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

if [ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]; then
    echo -e "${GREEN}โ SDKMAN! ya estรก instalado${NC}"
else
    echo "Instalando SDKMAN!..."
    curl -s "https://get.sdkman.io" | bash
    if [ $? -eq 0 ]; then
        source "$HOME/.sdkman/bin/sdkman-init.sh"
        echo -e "${GREEN}โ SDKMAN! instalado correctamente${NC}"
    else
        echo -e "${RED}โ Error al instalar SDKMAN!${NC}"
        exit 1
    fi
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 2. INSTALAR JAVA 21
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "2๏ธโฃ  INSTALANDO JAVA 21 LTS"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

source "$HOME/.sdkman/bin/sdkman-init.sh"

if command -v java &> /dev/null && java -version 2>&1 | grep -q "21"; then
    echo -e "${GREEN}โ Java 21 ya estรก instalado${NC}"
    java -version
else
    echo "Instalando Java 21 LTS..."
    sdk install java 21.0.1-tem
    sdk default java 21.0.1-tem
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}โ Java 21 instalado correctamente${NC}"
        java -version
    else
        echo -e "${RED}โ Error al instalar Java 21${NC}"
        exit 1
    fi
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 3. INSTALAR MAVEN
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "3๏ธโฃ  INSTALANDO MAVEN"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

if command -v mvn &> /dev/null; then
    echo -e "${GREEN}โ Maven ya estรก instalado${NC}"
    mvn -version
else
    echo "Instalando Maven..."
    sdk install maven
    sdk default maven
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}โ Maven instalado correctamente${NC}"
        mvn -version
    else
        echo -e "${RED}โ Error al instalar Maven${NC}"
        exit 1
    fi
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 4. INSTALAR NVM
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "4๏ธโฃ  INSTALANDO NVM (Node Version Manager)"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

if [ -s "$HOME/.nvm/nvm.sh" ]; then
    echo -e "${GREEN}โ NVM ya estรก instalado${NC}"
    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    nvm --version
else
    echo "Instalando NVM..."
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
    if [ $? -eq 0 ]; then
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
        
        # Agregar al perfil de shell
        if [[ "$SHELL" == *"zsh"* ]]; then
            echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.zshrc
            echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"' >> ~/.zshrc
        elif [[ "$SHELL" == *"bash"* ]]; then
            echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
            echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"' >> ~/.bashrc
        fi
        
        echo -e "${GREEN}โ NVM instalado correctamente${NC}"
        nvm --version
    else
        echo -e "${RED}โ Error al instalar NVM${NC}"
        exit 1
    fi
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 5. INSTALAR NODE.JS LTS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "5๏ธโฃ  INSTALANDO NODE.JS LTS"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

if command -v node &> /dev/null; then
    echo -e "${GREEN}โ Node.js ya estรก instalado${NC}"
    node -v
    npm -v
else
    echo "Instalando Node.js LTS..."
    nvm install --lts
    nvm use --lts
    nvm alias default node
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}โ Node.js instalado correctamente${NC}"
        node -v
        npm -v
    else
        echo -e "${RED}โ Error al instalar Node.js${NC}"
        exit 1
    fi
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 6. INSTALAR ANGULAR CLI
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "6๏ธโฃ  INSTALANDO ANGULAR CLI"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

if command -v ng &> /dev/null; then
    echo -e "${GREEN}โ Angular CLI ya estรก instalado${NC}"
    ng version
else
    echo "Instalando Angular CLI globalmente..."
    npm install -g @angular/cli
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}โ Angular CLI instalado correctamente${NC}"
        ng version
    else
        echo -e "${RED}โ Error al instalar Angular CLI${NC}"
        exit 1
    fi
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 7. VERIFICAR DOCKER
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "7๏ธโฃ  VERIFICANDO DOCKER"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

if command -v docker &> /dev/null; then
    echo -e "${GREEN}โ Docker estรก instalado${NC}"
    docker version
    if docker info &> /dev/null; then
        echo -e "${GREEN}โ Docker daemon estรก corriendo${NC}"
    else
        echo -e "${YELLOW}โ๏ธ  Docker daemon NO estรก corriendo${NC}"
        echo "   Por favor, inicia Docker Desktop o el servicio de Docker"
    fi
else
    echo -e "${YELLOW}โ๏ธ  Docker NO estรก instalado${NC}"
    echo "   Por favor, instala Docker Desktop desde: https://www.docker.com/products/docker-desktop/"
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# RESUMEN FINAL
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ              โ INSTALACIรN COMPLETA FINALIZADA          โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ Prรณximos pasos:"
echo "   1. Reinicia tu terminal o ejecuta: source ~/.zshrc (o ~/.bashrc)"
echo "   2. Ejecuta: ./scripts/verify_complete_env.sh para verificar todo"
echo "   3. Crea el proyecto Angular: ng new devmatch-frontend"
echo "   4. Consulta GUIA_INSTALACION_ENTORNO.md para mรกs detalles"
echo ""


